{% extends "base.html" %}
{% load custom_filters %}

{% block title %}ふりかえり{% endblock %}

{% block content %}
<!-- 📅 カレンダーナビゲーション -->
<div class="calendar-nav">
  <a href="?month={{ prev_month.month }}&year={{ prev_month.year }}">◀ 前の月</a>
  <span class="current-month">{{ current_date|date:"Y年n月" }}</span>
  <a href="?month={{ next_month.month }}&year={{ next_month.year }}">次の月 ▶</a>
</div>

<!-- 🧒 子ども選択プルダウン -->
<div class="child-selector">
  <form method="get" action="{% url 'review' %}" id="childSelectForm">
    <label for="child">本棚を選択:</label>
    <select name="child_id" id="child" onchange="document.getElementById('childSelectForm').submit()">
      <option value="" {% if not selected_child_id %}selected{% endif %}>共通の本棚</option>
      {% for child in children %}
        <option value="{{ child.id }}" {% if selected_child_id == child.id|stringformat:"s" %}selected{% endif %}>
          {{ child.name }}
        </option>
      {% endfor %}
    </select>
  </form>
</div>

{% if most_read_title %}
  <div class="most-read-banner">
    📚 今月もっとも読まれた絵本：<strong>{{ most_read_title }}</strong>
  </div>
{% endif %}

<!-- 🔼 カレンダーの上部などに追加 -->
<div class="monthly-summary">
    <p>📚 今月の読み聞かせ合計：{{ monthly_total }} 回</p>
    <ul>
      {% for child, total in child_totals.items %}
        <li>{{ child }}：{{ total }} 回</li>
      {% endfor %}
    </ul>
  </div>
  


<!-- 📚 カレンダー本体 -->
<div class="calendar-grid">
    {% for weekday in "日月火水木金土"|make_list %}
      <div class="calendar-weekday">{{ weekday }}</div>
    {% endfor %}
  
    {% for day in calendar_days %}
      <div class="calendar-cell">
        <div class="calendar-day">{{ day }}</div>
  
        {% with calendar_data|get_item:day as books %}
          {% if books %}
            {% for book in books %}
              <div class="book-icon" title="{{ book.title }}">
                <a href="{% url 'book_detail' book.id %}">
                  <img src="{{ book.image.url }}" alt="{{ book.title }}">
                </a>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
      </div>
    {% endfor %}
  </div>
  
{% endblock %}

